<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Jogador - Renascer Union</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .player-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .player-avatar {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }
        
        .player-details h2 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .player-details p {
            margin: 8px 0 0 0;
            opacity: 0.9;
            font-size: 16px;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }



        .dashboard-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: white;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
        }
        
        /* Estilos para o ranking de jogadores por item */
        .player-positions-alert {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }
        
        .player-positions-alert h4 {
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .positions-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .position-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .rankings-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .item-ranking {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }
        
        .item-title {
            color: #333;
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .ranking-player {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .ranking-player:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .ranking-player.logged-player {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            border: 2px solid #fdcb6e;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(253, 203, 110, 0.3);
        }
        
        .ranking-player.logged-player:hover {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
        }
        
        .ranking-player.inactive {
            opacity: 0.6;
        }
        
        .ranking-player .position {
            font-weight: bold;
            font-size: 16px;
            min-width: 40px;
        }
        
        .ranking-player .player-name {
            flex: 1;
            margin: 0 15px;
            font-weight: 500;
        }
        
        .ranking-player .player-count {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .show-more-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 15px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .show-more-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-button {
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
        }

        .nav-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .nav-button:hover:not(.active) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .content-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }

        .history-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 12px;
            font-weight: 500;
            color: #666;
            text-transform: uppercase;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .history-table th,
        .history-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .history-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            font-size: 14px;
            text-transform: uppercase;
        }

        .history-table tr:hover {
            background: #f8f9fa;
        }

        .item-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .date-badge {
            background: #e9ecef;
            color: #666;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .history-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .history-item-player {
            font-weight: 600;
            font-size: 16px;
            color: #333;
        }
        
        .history-item-date {
            font-size: 12px;
            color: #666;
            background: #f8f9fa;
            padding: 4px 10px;
            border-radius: 15px;
        }
        
        .history-item-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .history-item-icon {
            font-size: 24px;
        }
        
        .history-item-details {
            flex: 1;
        }
        
        .history-item-item {
            font-weight: 500;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .history-item-description {
            font-size: 14px;
            color: #666;
        }

        /* Estilos para Itens Liberados */
        .released-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #FF9800;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .released-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .released-item.selected {
            border-left-color: #4CAF50;
            background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
        }
        
        .released-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .released-item-name {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }
        
        .released-item-quantity {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .released-item-actions {
            display: flex;
            gap: 8px;
        }
        
        .select-item-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .select-item-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        .select-item-btn.selected {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        .select-item-btn.selected:hover {
            box-shadow: 0 4px 8px rgba(244, 67, 54, 0.3);
        }

        /* Estilos para Sorteio em Tempo Real */
        .draw-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease-out;
        }

        .draw-item.new {
            border-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            animation: newDrawItem 1s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes newDrawItem {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(-20px);
                border-color: #ffc107;
                background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            }
            50% {
                transform: scale(1.05) translateY(-5px);
                border-color: #28a745;
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
                border-color: #28a745;
                background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            }
        }

        .draw-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .draw-item-name {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .draw-item-time {
            font-size: 12px;
            color: #666;
            background: rgba(0, 0, 0, 0.1);
            padding: 4px 8px;
            border-radius: 10px;
        }

        .draw-winners {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .draw-winner {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .draw-winner.multiple {
            background: rgba(255, 193, 7, 0.1);
            border-left-color: #ffc107;
        }

        .draw-winner-icon {
            font-size: 18px;
        }

        .draw-winner-name {
            font-weight: 500;
            color: #333;
            flex: 1;
        }

        .draw-winner-badge {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
        }

        .draw-winner.multiple .draw-winner-badge {
            background: #ffc107;
            color: #333;
        }

        .draw-status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #28a745;
            font-weight: 500;
        }

        .draw-status-indicator::before {
            content: '●';
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Responsividade para o grid */
        @media (max-width: 768px) {
            .content-section > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }
        }

        /* Modal de Seleção de Itens */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .item-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .item-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }
        
        .item-card.selected {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
        }
        
        .item-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .item-name {
            font-weight: 600;
            color: #333;
        }
        
        .item-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .selected-count {
            color: #666;
            font-weight: 500;
        }
        
        .confirm-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        
        .confirm-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 768px) {
            .player-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .dashboard-nav {
                justify-content: center;
            }
            
            .nav-button {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
            
            .history-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .items-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="player-header">
            <div class="player-info">
                <div class="player-avatar">🎮</div>
                <div class="player-details">
                    <h2 id="player-name">Carregando...</h2>
                    <p>Dashboard do Jogador</p>
                </div>
            </div>
            <div style="display: flex; align-items: center;">
                <button class="logout-btn" onclick="logout()">
                    🚪 Sair
                </button>
            </div>
        </div>
        
        <div class="dashboard-nav">
            <button class="nav-button active" onclick="showSection('overview')">
                📊 Visão Geral
            </button>
            <button class="nav-button" onclick="showSection('history-general')">
                📋 Histórico Geral
            </button>
            <button class="nav-button" onclick="showSection('history-personal')">
                👤 Meu Histórico
            </button>
        </div>

        <!-- Seção Visão Geral -->
        <div id="overview-section" class="content-section active">
            <h2 class="section-title">
                📊 Visão Geral
            </h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="my-items-count">0</div>
                    <div class="stat-label">Meus Itens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-players">0</div>
                    <div class="stat-label">Total de Jogadores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-items">0</div>
                    <div class="stat-label">Total de Itens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="last-item-date">-</div>
                    <div class="stat-label">Último Item</div>
                </div>
            </div>
            
            <!-- Grid com duas colunas: Meus Últimos Itens e Sorteio em Tempo Real -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
                <!-- Coluna Esquerda: Meus Últimos Itens -->
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>🎯 Meus Últimos Itens</h3>
                        <button class="refresh-btn" onclick="loadOverviewData()">
                            🔄 Atualizar
                        </button>
                    </div>
                    
                    <div id="recent-items">
                        <div class="empty-state">
                            <div class="empty-state-icon">📦</div>
                            <p>Carregando seus itens...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Coluna Direita: Itens Liberados e Sorteio -->
                <div>
                    <!-- Seção de Itens Liberados -->
                    <div id="released-items-section" style="margin-bottom: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3>🎁 Itens Liberados</h3>
                            <div id="released-items-count" style="font-size: 12px; color: #666;">0 itens disponíveis</div>
                        </div>
                        
                        <div id="released-items-container" style="background: #f8f9fa; border-radius: 12px; padding: 20px; min-height: 120px;">
                            <div class="empty-state" id="empty-released-items" style="padding: 20px; text-align: center;">
                                <div class="empty-state-icon">📦</div>
                                <p>Nenhum item liberado ainda</p>
                                <small style="color: #999; margin-top: 10px; display: block;">Aguarde o admin liberar itens para seleção</small>
                            </div>
                            
                            <div id="released-items-list" style="display: none;">
                                <!-- Itens liberados serão inseridos aqui via JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Sorteio em Tempo Real -->
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>🎲 Sorteio em Tempo Real</h3>
                            <div id="draw-status" style="font-size: 12px; color: #666;">Aguardando sorteios...</div>
                        </div>
                    
                    <div id="realtime-draw" style="background: #f8f9fa; border-radius: 12px; padding: 20px; min-height: 200px;">
                        <div class="empty-state" id="empty-draw-state" style="padding: 40px 20px;">
                            <div class="empty-state-icon">🎲</div>
                            <p>Nenhum sorteio ativo no momento</p>
                            <small style="color: #999; margin-top: 10px; display: block;">Os sorteios aparecerão aqui quando o admin selecionar itens</small>
                        </div>
                        
                        <!-- Interface de Turno Ativo -->
                        <div id="active-turn" style="display: none;">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <div style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                    <h4 style="margin: 0; font-size: 18px;">🎯 Sua Vez!</h4>
                                </div>
                                
                                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <span style="font-weight: bold; color: #333;">Item:</span>
                                        <span id="current-item" style="color: #2196F3; font-weight: bold;"></span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <span style="font-weight: bold; color: #333;">Jogador:</span>
                                        <span id="current-player" style="color: #4CAF50; font-weight: bold;"></span>
                                    </div>
                                    <div id="priority-info" style="display: none; background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 10px; border-left: 4px solid #2196F3;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                            <span style="font-size: 12px; color: #666;">Posição na Fila:</span>
                                            <span id="priority-position" style="font-size: 12px; font-weight: bold; color: #2196F3;"></span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                            <span style="font-size: 12px; color: #666;">Quantidade Atual:</span>
                                            <span id="player-quantity" style="font-size: 12px; font-weight: bold; color: #FF9800;"></span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="font-size: 12px; color: #666;">Total na Fila:</span>
                                            <span id="queue-size" style="font-size: 12px; font-weight: bold; color: #4CAF50;"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <button id="skip-turn-btn" onclick="skipCurrentTurn()" 
                                        style="background: linear-gradient(135deg, #FF9800, #F57C00); color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255,152,0,0.3);">
                                    ⏭️ Passar para Próximo
                                </button>
                            </div>
                        </div>
                        

                    </div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin: 40px 0 20px 0;">
                <h3>🏆 Ranking de Jogadores</h3>
                <button class="refresh-btn" onclick="loadPlayersRanking()">
                    🔄 Atualizar
                </button>
            </div>
            
            <div id="players-ranking">
                <div class="empty-state">
                    <div class="empty-state-icon">🏆</div>
                    <p>Carregando ranking...</p>
                </div>
            </div>
        </div>

        <!-- Seção Histórico Geral -->
        <div id="history-general-section" class="content-section">
            <h2 class="section-title">
                📋 Histórico Geral de Itens
            </h2>
            
            <div class="history-filters">
                <div class="filter-group">
                    <label>Jogador</label>
                    <select id="filter-player-general">
                        <option value="">Todos os jogadores</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Item</label>
                    <input type="text" id="filter-item-general" placeholder="Nome do item">
                </div>
                <div class="filter-group">
                    <label>Data</label>
                    <input type="date" id="filter-date-general">
                </div>
                <button class="refresh-btn" onclick="loadGeneralHistory()">
                    🔍 Filtrar
                </button>
            </div>
            
            <div id="general-history-content">
                <div class="empty-state">
                    <div class="empty-state-icon">📋</div>
                    <p>Carregando histórico geral...</p>
                </div>
            </div>
        </div>

        <!-- Seção Histórico Pessoal -->
        <div id="history-personal-section" class="content-section">
            <h2 class="section-title">
                👤 Meu Histórico Pessoal
            </h2>
            
            <div class="history-filters">
                <div class="filter-group">
                    <label>Item</label>
                    <input type="text" id="filter-item-personal" placeholder="Nome do item">
                </div>
                <div class="filter-group">
                    <label>Data</label>
                    <input type="date" id="filter-date-personal">
                </div>
                <button class="refresh-btn" onclick="loadPersonalHistory()">
                    🔍 Filtrar
                </button>
            </div>
            
            <div id="personal-history-content">
                <div class="empty-state">
                    <div class="empty-state-icon">👤</div>
                    <p>Carregando seu histórico...</p>
                </div>
            </div>
        </div>
    </div>



    <!-- Supabase Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="src/config/config.js"></script>
    <script src="supabase-client.js"></script>
    
    <script>
        // Verificar autenticação
        if (localStorage.getItem('userType') !== 'player' || localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }
        
        // Aguardar carregamento completo da página e scripts
        window.addEventListener('load', function() {
            // Aguardar carregamento do Supabase
             if (typeof waitForSupabase === 'function') {
                 waitForSupabase(function() {
                     // Inicializar Supabase
                     if (typeof initSupabaseClient === 'function') {
                         const client = initSupabaseClient();
                         if (client) {
                             console.log('Cliente Supabase inicializado com sucesso');
                             
                             // Agora que o Supabase está pronto, inicializar os sistemas que dependem dele
                             loadOverviewData();
                             initializeRealtimeDraw();
                             initializeReleasedItems();
                         } else {
                             console.error('Falha ao inicializar cliente Supabase');
                         }
                     } else {
                         console.error('Função initSupabaseClient não encontrada');
                     }
                 });
             } else {
                 console.error('Função waitForSupabase não encontrada');
             }
            
            // Obter nick do jogador
            const playerNick = localStorage.getItem('playerNick');
            const playerNameElement = document.getElementById('player-name');
            if (playerNameElement) {
                playerNameElement.textContent = playerNick || 'Jogador';
            }
        });

        // Função para logout
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.clear();
                window.location.href = 'index.html';
            }
        }

        // Função para mostrar seção
        function showSection(sectionName) {
            // Remover classe active de todos os botões
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            
            // Remover classe active de todas as seções
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            
            // Adicionar classe active ao botão clicado
            event.target.classList.add('active');
            
            // Mostrar seção correspondente
            document.getElementById(sectionName + '-section').classList.add('active');
            
            // Carregar dados da seção
            switch(sectionName) {
                case 'overview':
                    loadOverviewData();
                    break;
                case 'history-general':
                    loadGeneralHistory();
                    break;
                case 'history-personal':
                    loadPersonalHistory();
                    break;
            }
        }

        // Função para carregar dados da visão geral
        async function loadOverviewData() {
            try {
                // Carregar histórico pessoal para contar itens
                const historyResponse = await fetch('/.netlify/functions/supabase-api/history');
                const historyData = await historyResponse.json();
                
                const myItems = historyData.history?.filter(entry => 
                    entry.player?.toLowerCase() === playerNick.toLowerCase()
                ) || [];
                
                document.getElementById('my-items-count').textContent = myItems.length;
                
                // Carregar total de jogadores
                const playersResponse = await fetch('/.netlify/functions/supabase-api/players');
                const playersData = await playersResponse.json();
                document.getElementById('total-players').textContent = playersData.players?.length || 0;
                
                // Carregar total de itens
                const itemsResponse = await fetch('/.netlify/functions/supabase-api/items');
                const itemsData = await itemsResponse.json();
                document.getElementById('total-items').textContent = itemsData.items?.length || 0;
                
                // Último item
                if (myItems.length > 0) {
                    const lastItem = myItems[myItems.length - 1];
                    const lastDate = new Date(lastItem.date).toLocaleDateString('pt-BR');
                    document.getElementById('last-item-date').textContent = lastDate;
                } else {
                    document.getElementById('last-item-date').textContent = 'Nenhum';
                }
                
                // Mostrar últimos itens
                const recentItemsContainer = document.getElementById('recent-items');
                if (myItems.length > 0) {
                    const recentItems = myItems.slice(-5).reverse();
                    recentItemsContainer.innerHTML = `
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Data</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${recentItems.map(item => `
                                    <tr>
                                        <td><span class="item-badge">${item.item}</span></td>
                                        <td><span class="date-badge">${new Date(item.date).toLocaleDateString('pt-BR')}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    recentItemsContainer.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">📦</div>
                            <p>Você ainda não recebeu nenhum item</p>
                        </div>
                    `;
                }
                
                // Carregar ranking de jogadores
                loadPlayersRanking();
                
            } catch (error) {
                console.error('Erro ao carregar dados da visão geral:', error);
            }
        }

        // Estado para controlar expansão dos rankings (global para todos os itens)
        let allRankingsExpanded = false;
        
        // Função para carregar ranking de jogadores por item
        async function loadPlayersRanking() {
            try {
                const playersResponse = await fetch('/.netlify/functions/supabase-api/players');
                const playersData = await playersResponse.json();
                const itemsResponse = await fetch('/.netlify/functions/supabase-api/items');
                const itemsData = await itemsResponse.json();
                
                const players = playersData.players || [];
                const items = itemsData.items || [];
                
                // Criar ranking para cada item
                const itemRankings = items.map(item => {
                    const itemName = typeof item === 'string' ? item : item.name || item;
                    const playersWithItem = players
                        .map(player => ({
                            name: player.name,
                            count: player.counts[itemName] || 0,
                            active: player.status === 'active'
                        }))
                        .sort((a, b) => a.count - b.count); // Ordena por quantidade crescente (menor no topo)
                    
                    return {
                        item: itemName,
                        players: playersWithItem
                    };
                });
                
                // Encontrar posição do jogador logado em cada item
                const playerPositions = {};
                itemRankings.forEach(ranking => {
                    const playerIndex = ranking.players.findIndex(p => 
                        p.name.toLowerCase() === playerNick.toLowerCase()
                    );
                    if (playerIndex !== -1) {
                        playerPositions[ranking.item] = playerIndex + 1;
                    }
                });
                
                const container = document.getElementById('players-ranking');
                
                // Mostrar aviso de posições do jogador
                const positionsHtml = Object.keys(playerPositions).length > 0 ? `
                    <div class="player-positions-alert">
                        <h4>🎯 Suas Posições:</h4>
                        <div class="positions-grid">
                            ${Object.entries(playerPositions).map(([item, position]) => {
                                const medal = position === 1 ? '🥇' : position === 2 ? '🥈' : position === 3 ? '🥉' : `#${position}`;
                                return `<span class="position-badge">${item}: ${medal}</span>`;
                            }).join('')}
                        </div>
                    </div>
                ` : '';
                
                const html = itemRankings.map((ranking, itemIndex) => {
                    const displayLimit = allRankingsExpanded ? ranking.players.length : 8;
                    const displayPlayers = ranking.players.slice(0, displayLimit);
                    const hasMorePlayers = ranking.players.length > 8;
                    
                    const playersHtml = displayPlayers.map((player, index) => {
                        const position = index + 1;
                        const medal = position === 1 ? '🥇' : position === 2 ? '🥈' : position === 3 ? '🥉' : `${position}º`;
                        const activeClass = player.status === 'active' ? 'active' : 'inactive';
                        const isLoggedPlayer = player.name.toLowerCase() === playerNick.toLowerCase();
                        const highlightClass = isLoggedPlayer ? 'logged-player' : '';
                        
                        return `
                            <div class="ranking-player ${activeClass} ${highlightClass}">
                                <span class="position">${medal}</span>
                                <span class="player-name">${player.name}${isLoggedPlayer ? ' (Você)' : ''}</span>
                                <span class="player-count">${player.count}</span>
                            </div>
                        `;
                    }).join('');
                    
                    // Mostrar botão apenas no primeiro item se algum item tiver mais de 8 jogadores
                    const anyItemHasMore = itemRankings.some(r => r.players.length > 8);
                    const showMoreButton = (itemIndex === 0 && anyItemHasMore) ? `
                        <button class="show-more-btn" onclick="toggleAllRankingsExpansion()">
                            ${allRankingsExpanded ? '📤 Mostrar Menos (Todos os Itens)' : '📥 Mostrar Mais (Todos os Itens)'}
                        </button>
                    ` : '';
                    
                    return `
                        <div class="item-ranking">
                            <h4 class="item-title">${ranking.item}</h4>
                            <div class="ranking-list">
                                ${playersHtml}
                            </div>
                            ${showMoreButton}
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = positionsHtml + `<div class="rankings-container">${html}</div>`;
                
            } catch (error) {
                console.error('Erro ao carregar ranking de jogadores:', error);
                const container = document.getElementById('players-ranking');
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">❌</div>
                        <p>Erro ao carregar ranking</p>
                    </div>
                `;
            }
        }
        
        // Função para alternar expansão do ranking
        function toggleAllRankingsExpansion() {
            allRankingsExpanded = !allRankingsExpanded;
            loadPlayersRanking();
        }

        // Função para carregar histórico geral
        async function loadGeneralHistory() {
            try {
                const response = await fetch('/.netlify/functions/supabase-api/history');
                const data = await response.json();
                
                let history = data.history || [];
                
                // Aplicar filtros
                const playerFilter = document.getElementById('filter-player-general').value;
                const itemFilter = document.getElementById('filter-item-general').value.toLowerCase();
                const dateFilter = document.getElementById('filter-date-general').value;
                
                if (playerFilter) {
                    history = history.filter(entry => entry.player === playerFilter);
                }
                
                if (itemFilter) {
                    history = history.filter(entry => 
                        entry.item.toLowerCase().includes(itemFilter)
                    );
                }
                
                if (dateFilter) {
                    history = history.filter(entry => {
                        const entryDate = new Date(entry.date).toISOString().split('T')[0];
                        return entryDate === dateFilter;
                    });
                }
                
                // Carregar lista de jogadores para o filtro
                const playersResponse = await fetch('/.netlify/functions/supabase-api/players');
                const playersData = await playersResponse.json();
                const playerSelect = document.getElementById('filter-player-general');
                playerSelect.innerHTML = '<option value="">Todos os jogadores</option>';
                playersData.players?.forEach(player => {
                    playerSelect.innerHTML += `<option value="${player.name}">${player.name}</option>`;
                });
                
                // Mostrar histórico
                const container = document.getElementById('general-history-content');
                if (history.length > 0) {
                    container.innerHTML = `
                        <div class="history-list">
                            ${history.map(entry => `
                                <div class="history-item">
                                    <div class="history-item-header">
                                        <div class="history-item-player">👤 ${entry.player}</div>
                                        <div class="history-item-date">${new Date(entry.date).toLocaleDateString('pt-BR')}</div>
                                    </div>
                                    <div class="history-item-content">
                                        <div class="history-item-icon">📦</div>
                                        <div class="history-item-details">
                                            <div class="history-item-item">${entry.item}</div>
                                            <div class="history-item-description">Item recebido pelo jogador</div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">📋</div>
                            <p>Nenhum registro encontrado</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Erro ao carregar histórico geral:', error);
            }
        }

        // Função para carregar histórico pessoal
        async function loadPersonalHistory() {
            try {
                const response = await fetch('/.netlify/functions/supabase-api/history');
                const data = await response.json();
                
                let history = data.history?.filter(entry => 
                    entry.player?.toLowerCase() === playerNick.toLowerCase()
                ) || [];
                
                // Aplicar filtros
                const itemFilter = document.getElementById('filter-item-personal').value.toLowerCase();
                const dateFilter = document.getElementById('filter-date-personal').value;
                
                if (itemFilter) {
                    history = history.filter(entry => 
                        entry.item.toLowerCase().includes(itemFilter)
                    );
                }
                
                if (dateFilter) {
                    history = history.filter(entry => {
                        const entryDate = new Date(entry.date).toISOString().split('T')[0];
                        return entryDate === dateFilter;
                    });
                }
                
                // Mostrar histórico
                const container = document.getElementById('personal-history-content');
                if (history.length > 0) {
                    container.innerHTML = `
                        <div class="history-list">
                            ${history.map(entry => `
                                <div class="history-item">
                                    <div class="history-item-header">
                                        <div class="history-item-player">🎯 Meu Item</div>
                                        <div class="history-item-date">${new Date(entry.date).toLocaleDateString('pt-BR')}</div>
                                    </div>
                                    <div class="history-item-content">
                                        <div class="history-item-icon">📦</div>
                                        <div class="history-item-details">
                                            <div class="history-item-item">${entry.item}</div>
                                            <div class="history-item-description">Item recebido por você</div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">👤</div>
                            <p>Você ainda não possui histórico de itens</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Erro ao carregar histórico pessoal:', error);
            }
        }

        // Variáveis globais para sorteio em tempo real
        let currentDraw = null;
        let drawSubscription = null;
        let currentPlayerName = localStorage.getItem('currentPlayer') || '';

        // Função para inicializar sorteio em tempo real
        function initializeRealtimeDraw() {
            // Configurar escuta em tempo real para mudanças na tabela players (sorteios)
            if (typeof supabase !== 'undefined' && supabase.channel) {
                drawSubscription = supabase
                    .channel('draw-results')
                    .on('postgres_changes', {
                        event: 'INSERT',
                        schema: 'public',
                        table: 'players'
                    }, handleNewDraw)
                    .on('postgres_changes', {
                        event: 'UPDATE', 
                        schema: 'public',
                        table: 'players'
                    }, handleDrawUpdate)
                    .on('postgres_changes', {
                        event: 'DELETE', 
                        schema: 'public',
                        table: 'players'
                    }, handleDrawDelete)
                    .subscribe();
                
                console.log('Sorteio em tempo real inicializado');
                updateDrawStatus('Conectado - Aguardando sorteios...');
                
                // Carregar sorteio atual se existir
                loadCurrentDraw();
            } else {
                console.warn('Supabase não disponível para sorteio em tempo real');
                updateDrawStatus('Offline - Sorteios não disponíveis');
            }
        }

        // Função para carregar sorteio atual
        async function loadCurrentDraw() {
            try {
                // Verificar localStorage primeiro
                const localDraw = localStorage.getItem('currentDraw');
                if (localDraw) {
                    const drawData = JSON.parse(localDraw);
                    currentDraw = drawData;
                    displayCurrentDraw(drawData);
                    return;
                }

                // Buscar na tabela players por registros de sorteio ativo
                const { data, error } = await supabase
                    .from('players')
                    .select('*')
                    .like('name', 'DRAW_ACTIVE_%')
                    .eq('total_received', 1)
                    .order('created_at', { ascending: false })
                    .limit(1);

                if (data && data.length > 0 && !error) {
                    // Extrair dados do nome do registro
                    const drawRecord = data[0];
                    const nameParts = drawRecord.name.replace('DRAW_ACTIVE_', '').split('_');
                    const timestamp = nameParts.pop();
                    const itemName = nameParts.pop();
                    const playerName = nameParts.join('_');

                    const drawData = {
                        id: drawRecord.id,
                        player_name: playerName,
                        item_name: itemName,
                        draw_time: drawRecord.created_at,
                        status: 'active'
                    };

                    currentDraw = drawData;
                    displayCurrentDraw(drawData);
                }
            } catch (error) {
                console.log('Nenhum sorteio ativo encontrado');
            }
        }

        // Função para lidar com novos sorteios
        function handleNewDraw(payload) {
            console.log('Novo sorteio detectado:', payload);
            const playerRecord = payload.new;
            
            // Verificar se é um registro de sorteio ativo
            if (playerRecord.name && playerRecord.name.startsWith('DRAW_ACTIVE_') && playerRecord.total_received === 1) {
                // Extrair dados do nome do registro
                const nameParts = playerRecord.name.replace('DRAW_ACTIVE_', '').split('_');
                const timestamp = nameParts.pop();
                const itemName = nameParts.pop();
                const playerName = nameParts.join('_');

                const drawData = {
                    id: playerRecord.id,
                    player_name: playerName,
                    item_name: itemName,
                    draw_time: playerRecord.created_at,
                    status: 'active'
                };

                currentDraw = drawData;
                displayCurrentDraw(drawData);
                updateDrawStatus('Sorteio ativo!');
            }
        }

        // Função para lidar com atualizações de sorteio
        function handleDrawUpdate(payload) {
            console.log('Sorteio atualizado:', payload);
            const playerRecord = payload.new;
            
            // Verificar se é um registro de sorteio ativo
            if (playerRecord.name && playerRecord.name.startsWith('DRAW_ACTIVE_') && playerRecord.total_received === 1) {
                // Extrair dados do nome do registro
                const nameParts = playerRecord.name.replace('DRAW_ACTIVE_', '').split('_');
                const timestamp = nameParts.pop();
                const itemName = nameParts.pop();
                const playerName = nameParts.join('_');

                const drawData = {
                    id: playerRecord.id,
                    player_name: playerName,
                    item_name: itemName,
                    draw_time: playerRecord.created_at,
                    status: 'active'
                };

                currentDraw = drawData;
                displayCurrentDraw(drawData);
            }
        }

        // Função para lidar com exclusão de sorteio
        function handleDrawDelete(payload) {
            console.log('Sorteio removido:', payload);
            currentDraw = null;
            hideCurrentDraw();
            updateDrawStatus('Aguardando sorteios...');
        }

        // Função para exibir sorteio atual
        function displayCurrentDraw(drawData) {
            const emptyState = document.getElementById('empty-draw-state');
            const activeTurn = document.getElementById('active-turn');
            const currentItem = document.getElementById('current-item');
            const currentPlayer = document.getElementById('current-player');
            const skipBtn = document.getElementById('skip-turn-btn');
            const priorityInfo = document.getElementById('priority-info');
            const priorityPosition = document.getElementById('priority-position');
            const playerQuantity = document.getElementById('player-quantity');
            const queueSize = document.getElementById('queue-size');
            
            if (emptyState) emptyState.style.display = 'none';
            if (activeTurn) activeTurn.style.display = 'block';
            
            if (currentItem) currentItem.textContent = drawData.item_name;
            if (currentPlayer) currentPlayer.textContent = drawData.player_name;
            
            // Mostrar informações de prioridade se disponíveis
            if (drawData.priority_position && priorityInfo) {
                priorityInfo.style.display = 'block';
                if (priorityPosition) priorityPosition.textContent = `${drawData.priority_position}º`;
                if (playerQuantity) playerQuantity.textContent = drawData.player_quantity || '0';
                if (queueSize) queueSize.textContent = `${drawData.total_queue_size} jogadores`;
            } else if (priorityInfo) {
                priorityInfo.style.display = 'none';
            }
            
            // Mostrar botão apenas se for o jogador da vez
            if (skipBtn) {
                if (drawData.player_name === currentPlayerName) {
                    skipBtn.style.display = 'inline-block';
                    skipBtn.style.background = 'linear-gradient(135deg, #FF9800, #F57C00)';
                    skipBtn.textContent = '⏭️ Passar para Próximo';
                } else {
                    skipBtn.style.display = 'none';
                }
            }
        }
        
        // Função para esconder sorteio atual
        function hideCurrentDraw() {
            const emptyState = document.getElementById('empty-draw-state');
            const activeTurn = document.getElementById('active-turn');
            
            if (emptyState) emptyState.style.display = 'block';
            if (activeTurn) activeTurn.style.display = 'none';
        }
        

        
        // Função para passar o turno
        async function skipCurrentTurn() {
            if (!currentDraw) return;
            
            try {
                // Remover registro de sorteio ativo da tabela players
                await supabase
                    .from('players')
                    .delete()
                    .eq('id', currentDraw.id);
                
                // Limpar localStorage
                localStorage.removeItem('currentDraw');
                
                // Limpar estado local
                currentDraw = null;
                hideCurrentDraw();
                updateDrawStatus('Aguardando próximo sorteio...');
                
                console.log('Turno passado com sucesso');
                
                // Trigger próximo sorteio no backend
                await triggerNextInQueue(currentDraw.item_name);
                
                console.log('Turno passado com sucesso');
            } catch (error) {
                console.error('Erro ao passar turno:', error);
            }
        }
        
        // Função para trigger próximo da fila
        async function triggerNextInQueue(itemName) {
            try {
                // Simular a lógica de encontrar próximo jogador
                // Em uma implementação real, isso seria feito no admin dashboard
                console.log(`Próximo sorteio para ${itemName} deve ser acionado pelo admin`);
                
                // Notificar que o item ainda está disponível para sorteio
                updateDrawStatus(`Item ${itemName} disponível para novo sorteio`);
                
                // Opcional: fazer uma chamada para notificar o admin dashboard
                // que um jogador passou o turno e o item está disponível novamente
                
            } catch (error) {
                console.error('Erro ao trigger próximo sorteio:', error);
            }
        }

        // Função global para ser chamada pelo botão
        window.skipCurrentTurn = skipCurrentTurn;

        // Função para atualizar status do sorteio
        function updateDrawStatus(status) {
            const statusElement = document.getElementById('draw-status');
            if (statusElement) {
                statusElement.innerHTML = `<span class="draw-status-indicator">${status}</span>`;
            }
        }

        // Função para simular sorteio (para testes)
        function simulateDraw() {
            const testItems = ['Espada Lendária', 'Armadura Épica', 'Poção Rara', 'Gema Mística'];
            const testPlayers = ['João', 'Maria', 'Pedro', 'Ana', 'Carlos'];
            
            const randomItem = testItems[Math.floor(Math.random() * testItems.length)];
            const numWinners = Math.random() > 0.7 ? 2 : 1; // 30% chance de múltiplos ganhadores
            const winners = [];
            
            for (let i = 0; i < numWinners; i++) {
                const availablePlayers = testPlayers.filter(p => !winners.includes(p));
                if (availablePlayers.length > 0) {
                    const randomPlayer = availablePlayers[Math.floor(Math.random() * availablePlayers.length)];
                    winners.push(randomPlayer);
                }
            }
            
            const mockDraw = {
                id: Date.now(),
                item_name: randomItem,
                winners: winners,
                created_at: new Date().toISOString()
            };
        }

        // Os dados serão carregados após a inicialização do Supabase
        
        // Para testes - remover em produção
        // setInterval(simulateDraw, 10000); // Simula sorteio a cada 10 segundos
    
    // ===== SISTEMA DE ITENS LIBERADOS =====
    
    // Inicializar sistema de itens liberados
    function initializeReleasedItems() {
        // Carregar itens liberados do Supabase
        loadReleasedItems();
        
        // Configurar sincronização em tempo real
        setupReleasedItemsRealtime();
    }
    
    // Configurar sincronização em tempo real para itens liberados
    function setupReleasedItemsRealtime() {
        try {
            // Obter cliente Supabase
            const supabaseClient = getSupabaseClient();
            if (!supabaseClient) {
                console.error('Cliente Supabase não disponível');
                return;
            }
            
            // Escutar mudanças na tabela released_items
            const subscription = supabaseClient
                .channel('released-items-changes')
                .on('postgres_changes', {
                    event: '*',
                    schema: 'public',
                    table: 'released_items'
                }, () => {
                    loadReleasedItems();
                })
                .subscribe();
        } catch (error) {
            console.error('Erro ao configurar sincronização em tempo real:', error);
        }
    }
    
    // Carregar itens liberados do Supabase
    async function loadReleasedItems() {
        try {
            // Obter cliente Supabase
            const supabaseClient = getSupabaseClient();
            if (!supabaseClient) {
                console.error('Cliente Supabase não disponível');
                renderReleasedItems([]);
                return;
            }
            
            const { data, error } = await supabaseClient
                .from('released_items')
                .select('item_name, quantity')
                .order('created_at', { ascending: false });
            
            if (error) {
                console.error('Erro ao carregar itens liberados:', error);
                renderReleasedItems([]);
                return;
            }
            
            // Converter para formato esperado [nome, quantidade]
            const releasedItems = data ? data.map(item => [item.item_name, item.quantity]) : [];
            renderReleasedItems(releasedItems);
        } catch (error) {
            console.error('Erro ao carregar itens liberados:', error);
            renderReleasedItems([]);
        }
    }
    
    // Renderizar itens liberados
    function renderReleasedItems(releasedItems) {
        const container = document.getElementById('released-items-container');
        const emptyState = document.getElementById('empty-released-items');
        const itemsList = document.getElementById('released-items-list');
        const countElement = document.getElementById('released-items-count');
        
        if (!container || !emptyState || !itemsList || !countElement) return;
        
        if (releasedItems.length === 0) {
            emptyState.style.display = 'block';
            itemsList.style.display = 'none';
            countElement.textContent = '0 itens disponíveis';
            return;
        }
        
        emptyState.style.display = 'none';
        itemsList.style.display = 'block';
        
        const totalQuantity = releasedItems.reduce((sum, [, quantity]) => sum + quantity, 0);
        countElement.textContent = `${releasedItems.length} tipos (${totalQuantity} itens)`;
        
        // Carregar seleções do jogador atual
        const playerSelections = getPlayerSelections();
        
        const itemsHtml = releasedItems.map(([itemName, quantity]) => {
            const isSelected = playerSelections.has(itemName);
            const buttonText = isSelected ? 'Remover' : 'Selecionar';
            const buttonClass = isSelected ? 'selected' : '';
            
            return `
                <div class="released-item ${isSelected ? 'selected' : ''}">
                    <div class="released-item-info">
                        <span class="released-item-name">${itemName}</span>
                        <span class="released-item-quantity">${quantity}x</span>
                    </div>
                    <div class="released-item-actions">
                        <button class="select-item-btn ${buttonClass}" 
                                onclick="toggleItemSelection('${itemName}')">
                            ${buttonText}
                        </button>
                    </div>
                </div>
            `;
        }).join('');
        
        itemsList.innerHTML = itemsHtml;
    }
    
    // Obter seleções do jogador atual
    function getPlayerSelections() {
        try {
            const playerSelectionsData = localStorage.getItem('playerSelections');
            if (!playerSelectionsData) return new Set();
            
            const allSelections = JSON.parse(playerSelectionsData);
            const currentPlayerName = getCurrentPlayerName();
            
            // Encontrar seleções do jogador atual
            const playerData = allSelections.find(([playerName]) => playerName === currentPlayerName);
            return playerData ? new Set(playerData[1]) : new Set();
        } catch (error) {
            console.error('Erro ao carregar seleções do jogador:', error);
            return new Set();
        }
    }
    
    // Obter nome do jogador atual
    function getCurrentPlayerName() {
        // Tentar obter do localStorage primeiro
        const savedPlayer = localStorage.getItem('currentPlayer');
        if (savedPlayer) {
            try {
                const playerData = JSON.parse(savedPlayer);
                return playerData.name || playerData;
            } catch (e) {
                return savedPlayer;
            }
        }
        
        // Fallback: tentar obter do elemento da página
        const playerNameElement = document.querySelector('.player-details h2');
        return playerNameElement ? playerNameElement.textContent.trim() : 'Jogador Desconhecido';
    }
    
    // Alternar seleção de item
    function toggleItemSelection(itemName) {
        const currentPlayerName = getCurrentPlayerName();
        
        if (!currentPlayerName || currentPlayerName === 'Jogador Desconhecido') {
            alert('Erro: Nome do jogador não identificado');
            return;
        }
        
        try {
            const playerSelections = getPlayerSelections();
            
            if (playerSelections.has(itemName)) {
                // Remover seleção
                if (typeof window.removePlayerSelection === 'function') {
                    window.removePlayerSelection(currentPlayerName, itemName);
                } else {
                    // Fallback local
                    removePlayerSelectionLocal(currentPlayerName, itemName);
                }
            } else {
                // Adicionar seleção
                if (typeof window.registerPlayerSelection === 'function') {
                    window.registerPlayerSelection(currentPlayerName, itemName);
                } else {
                    // Fallback local
                    addPlayerSelectionLocal(currentPlayerName, itemName);
                }
            }
            
            // Recarregar itens para atualizar interface
            setTimeout(loadReleasedItems, 100);
            
        } catch (error) {
            console.error('Erro ao alternar seleção:', error);
            alert('Erro ao processar seleção. Tente novamente.');
        }
    }
    
    // Adicionar seleção local (fallback)
    function addPlayerSelectionLocal(playerName, itemName) {
        try {
            const playerSelectionsData = localStorage.getItem('playerSelections');
            let allSelections = playerSelectionsData ? JSON.parse(playerSelectionsData) : [];
            
            // Encontrar ou criar entrada do jogador
            let playerIndex = allSelections.findIndex(([name]) => name === playerName);
            
            if (playerIndex === -1) {
                allSelections.push([playerName, [itemName]]);
            } else {
                const playerSelections = new Set(allSelections[playerIndex][1]);
                playerSelections.add(itemName);
                allSelections[playerIndex][1] = Array.from(playerSelections);
            }
            
            localStorage.setItem('playerSelections', JSON.stringify(allSelections));
        } catch (error) {
            console.error('Erro ao adicionar seleção local:', error);
        }
    }
    
    // Remover seleção local (fallback)
    function removePlayerSelectionLocal(playerName, itemName) {
        try {
            const playerSelectionsData = localStorage.getItem('playerSelections');
            if (!playerSelectionsData) return;
            
            let allSelections = JSON.parse(playerSelectionsData);
            
            // Encontrar entrada do jogador
            let playerIndex = allSelections.findIndex(([name]) => name === playerName);
            
            if (playerIndex !== -1) {
                const playerSelections = new Set(allSelections[playerIndex][1]);
                playerSelections.delete(itemName);
                
                if (playerSelections.size === 0) {
                    // Remover jogador se não tem mais seleções
                    allSelections.splice(playerIndex, 1);
                } else {
                    allSelections[playerIndex][1] = Array.from(playerSelections);
                }
                
                localStorage.setItem('playerSelections', JSON.stringify(allSelections));
            }
        } catch (error) {
            console.error('Erro ao remover seleção local:', error);
        }
    }
    
    </script>
</body>
</html>